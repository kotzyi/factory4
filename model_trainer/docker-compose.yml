version: '3'
services:
        factory4:
                container_name: model_trainer
                image: kotzyi/model-trainer:0.1.1
                command: /home/detector/entrypoint.sh
                runtime: nvidia
                environment:
                        - "IMAGE_PATH=${IMAGE_PATH}"
                        - "IMAGE_LABEL_DIR=${IMAGE_LABEL_DIR}"
                        - "TRAIN_IMAGE_PATH=${TRAIN_IMAGE_PATH}"
                        - "TRAIN_IMAGE_LABEL_PATH=${TRAIN_IMAGE_LABEL_PATH}"
                        - "TRAIN_IMAGE_TFRECORD_PATH=${TRAIN_IMAGE_TFRECORD_PATH}"
                        - "TEST_IMAGE_PATH=${TEST_IMAGE_PATH}"
                        - "TEST_IMAGE_LABEL_PATH=${TEST_IMAGE_LABEL_PATH}"
                        - "TEST_IMAGE_TFRECORD_PATH=${TEST_IMAGE_TFRECORD_PATH}"
                        - "TEST_IMAGE_RATIO=${TEST_IMAGE_RATIO}"
                        - "MODEL_PATH=${MODEL_PATH}"
                        - "MODEL_PIPELINE_CONFIG_PATH=${MODEL_PIPELINE_CONFIG_PATH}"
                        - "INPUT_TYPE=${INPUT_TYPE}"
                        - "TRAINED_CHECKPOINT_PATH=${TRAINED_CHECKPOINT_PATH}"
                        - "MODEL_OUTPUT_PATH=${MODEL_OUTPUT_PATH}"
                        - "PRE_TRAINED_MODEL_PATH=${PRE_TRAINED_MODEL_PATH}"
                        - "AZURE_STORAGE_CONNECTION_STRING=${AZURE_STORAGE_CONNECTION_STRING}"
                        - "MODEL_NAME=${MODEL_NAME}"
                        - "AZURE_SHARE_NAME=${AZURE_SHARE_NAME}"
                        - "AZURE_IMAGE_DIR_PATH=${AZURE_IMAGE_DIR_PATH}"
                        - "AZURE_LABEL_DIR_PATH=${AZURE_LABEL_DIR_PATH}"
                        - "AZURE_MODEL_DIR_PATH=${AZURE_MODEL_DIR_PATH}"
                volumes:
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/images:/home/detector/workspace/images
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/annotations/:/home/detector/workspace/annotations
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/models/pre-trained-models:/home/detector/workspace/models/pre-trained-models
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/models/exported-models:/home/detector/workspace/models/exported-models
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/entrypoint.sh:/home/detector/entrypoint.sh
                        - /datadrive/jlee/projects/github.com/kotzyi/factory4/model_trainer/scripts:/home/detector/scripts
                ports:
                        - "60066"
